const dotenv = require("dotenv");
dotenv.config();

const { Pool, Client } = require('pg')

const connectionString = process.env.DATABASE_URL;

const pool = new Pool({connectionString: connectionString,    
  // number of milliseconds a client must sit idle in the pool and not be checked out
  // before it is disconnected from the backend and discarded
  // default is 10000 (10 seconds) - set to 0 to disable auto-disconnection of idle clients
  idleTimeoutMillis: 500,
  // maximum number of clients the pool should contain
  // by default this is set to 10.
  max: 80, 
  ssl: {
  rejectUnauthorized: false
}});

const client = new Client({connectionString: connectionString,    
  ssl: {
  rejectUnauthorized: false
}})
client.connect()
client.query('LISTEN virtual')
client.on('notification', msg => {
  console.log(msg.channel) // foo
  console.log(msg.payload) // bar!
})


//console.log('POSTGRES', process.env.DATABASE_URL);
module.exports = {
  query: (text, params) => pool.query(text, params),
}